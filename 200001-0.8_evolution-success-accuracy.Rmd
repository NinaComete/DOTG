---
output:
  html_document:
    fig_width: 8
    fig_height: 6
---

<span style='font-size:10pt;'>Auteur: Nina Lendrin</span> <br>
<span style='font-size:10pt;'>Date: `r Sys.Date()`</span>

<br><br>

<span style='font-size:14pt; font-weight:bold;'>Évolution du succès moyen (ssrate.average) et de la précision moyenne (accuracy.average) sur la période de 200001 itérations, c'est à dire sur une seule génération de 40 agents avec un taux de transmission initial (ttratio) de 0.8 lorsque l'induction se fait par apprentissage (learn) et minimal lorsque l'induction se fait de façon aléatoire (random) </span>


```{r, echo=FALSE}
library(ggplot2)
library(readr)
library(gridExtra)

# Chargement des données
G_200001_08_learn <- read.csv("D:\\Users\\hlendrin\\Documents\\R_DOTG\\200001-0.8-learn\\average.csv", header = TRUE, sep = " ")
G_200001_08_random <- read.csv("D:\\Users\\hlendrin\\Documents\\R_DOTG\\200001-0.8-random\\average.csv", header = TRUE, sep = " ")

# Seuil de changement minimal pour déterminer la stabilité de avg.accuracy
seuil_changement <- 0.0000001  # Seuil pour les fichiers

# Trouver le rang de l'itération où la stabilité de avg.accuracy est atteinte pour G_200001_08_learn
indices_stabilite_learn <- which(diff(G_200001_08_learn$avg.accuracy) <= seuil_changement)

# Identifier la première occurrence où la stabilité est atteinte sur plusieurs itérations pour G_200001_08_learn
stabilite_trouvee_learn <- FALSE
for (i in indices_stabilite_learn) {
  nb_iterations_verifier <- 1000  # Définir la valeur de nb_iterations_verifier ici
  if (all(diff(G_200001_08_learn$avg.accuracy[(i+1):(i+nb_iterations_verifier)]) <= seuil_changement)) {
    iteration_stabilite_learn <- i + 1
    valeur_stabilite_learn <- G_200001_08_learn$avg.accuracy[iteration_stabilite_learn]
    stabilite_trouvee_learn <- TRUE
    break
  }
}

# Modifier le graphique pour inclure l'étiquette au point de croisement des courbes pour G_200001_08_learn
evolution_success_accuracy_G_200001_08_learn <- ggplot(G_200001_08_learn, aes(x = seq_along(avg.ssrate), y = avg.ssrate)) +
  geom_line(color = "blue", aes(x = seq_along(avg.ssrate), y = avg.ssrate, linetype = "avg.ssrate (200001-08-learn)")) +  # Courbe pour avg.ssrate
  geom_line(aes(y = avg.accuracy, linetype = "avg.accuracy (200001-08-learn)"), color = "red") +  # Courbe pour avg.accuracy
  geom_text(data = data.frame(x = iteration_stabilite_learn,
                              y = valeur_stabilite_learn,
                              label = paste("avg.ssrate : ", round(G_200001_08_learn$avg.ssrate[iteration_stabilite_learn], 4), "(", iteration_stabilite_learn, ")\n",
                                            "avg.accuracy : ", round(valeur_stabilite_learn, 4), "(", iteration_stabilite_learn, ")")),
            aes(x = x, y = y, label = label), hjust = -0.2, vjust = 1, color = "black") +  # Ajout du texte pour le point de croisement
  labs(x = "Nombre d'itérations", y = "Valeur") +  # Étiquettes des axes
  ggtitle("G_200001_08_learn : Valeurs du succès et de la précision par itération") +  # Titre du graphique
  theme_minimal() +  # Style minimal du graphique
  scale_linetype_manual(values = c("avg.ssrate (200001-08-learn)" = "solid", "avg.accuracy (200001-08-learn)" = "solid")) +  # Style des lignes
  labs(linetype = "Variable") +  # Légende des styles de ligne
  theme(legend.position = "top")  # Position de la légende

# Trouver le rang de l'itération où la stabilité de avg.accuracy est atteinte pour G_200001_08_random
indices_stabilite_random <- which(diff(G_200001_08_random$avg.accuracy) <= seuil_changement)

# Identifier la première occurrence où la stabilité est atteinte sur plusieurs itérations pour G_200001_08_random
stabilite_trouvee_random <- FALSE
for (i in indices_stabilite_random) {
  if (all(diff(G_200001_08_random$avg.accuracy[(i+1):(i+nb_iterations_verifier)]) <= seuil_changement)) {
    iteration_stabilite_random <- i + 1
    valeur_stabilite_random <- G_200001_08_random$avg.accuracy[iteration_stabilite_random]
    stabilite_trouvee_random <- TRUE
    break
  }
}

# Modifier le graphique pour inclure l'étiquette au point de croisement des courbes pour G_200001_08_random
evolution_success_accuracy_G_200001_08_random <- ggplot(G_200001_08_random, aes(x = seq_along(avg.ssrate), y = avg.ssrate)) +
  geom_line(color = "purple", aes(x = seq_along(avg.ssrate), y = avg.ssrate, linetype = "avg.ssrate (200001-08-random)")) +  # Courbe pour avg.ssrate
  geom_line(aes(y = avg.accuracy, linetype = "avg.accuracy (200001-08-random)"), color = "orange") +  # Courbe pour avg.accuracy
  geom_text(data = data.frame(x = iteration_stabilite_random,
                              y = valeur_stabilite_random,
                              label = paste("avg.ssrate : ", round(G_200001_08_random$avg.ssrate[iteration_stabilite_random], 4), "(", iteration_stabilite_random, ")\n",
                                            "avg.accuracy : ", round(valeur_stabilite_random, 4), "(", iteration_stabilite_random, ")")),
            aes(x = x, y = y, label = label), hjust = -0.2, vjust = 1, color = "black") +  # Ajout du texte pour le point de croisement
  labs(x = "Nombre d'itérations", y = "Valeur") +  # Étiquettes des axes
  ggtitle("G_200001_08_random : Valeurs du succès et de la précision par itération") +  # Titre du graphique
  theme_minimal() +  # Style minimal du graphique
  scale_linetype_manual(values = c("avg.ssrate (200001-08-random)" = "solid", "avg.accuracy (200001-08-random)" = "solid")) +  # Style des lignes
  labs(linetype = "Variable") +  # Légende des styles de ligne
  theme(legend.position = "top")  # Position de la légende

# Combinaison des deux graphiques
combined_plot <- grid.arrange(evolution_success_accuracy_G_200001_08_learn, evolution_success_accuracy_G_200001_08_random, nrow = 2)

```
