---
title : " Populations dont la durée de vie moyenne est de 30001 itérations (période = 20001) selon le taux de transmission effectif ou aléatoire (moyenne des random) "
output:
  html_document
    
---

```{r, echo=FALSE, results='asis', warning=FALSE}

library(ggplot2)
library(readr)
library(knitr)
library(kableExtra)
library(dplyr)

create_summary_table <- function() {
  # Liste des URLs des fichiers
  urls <- c("https://raw.githubusercontent.com/NinaComete/DOTG/master/20001-1-learn/average.csv",
            "https://raw.githubusercontent.com/NinaComete/DOTG/master/20001-0.8-learn/average.csv",
            "https://raw.githubusercontent.com/NinaComete/DOTG/master/20001-0.6-learn/average.csv",
            "https://raw.githubusercontent.com/NinaComete/DOTG/master/20001-0.4-learn/average.csv",
            "https://raw.githubusercontent.com/NinaComete/DOTG/master/20001-0.2-learn/average.csv",
            "https://raw.githubusercontent.com/NinaComete/DOTG/master/20001-1-random/average.csv",
            "https://raw.githubusercontent.com/NinaComete/DOTG/master/20001-0.8-random/average.csv",
            "https://raw.githubusercontent.com/NinaComete/DOTG/master/20001-0.6-random/average.csv",
            "https://raw.githubusercontent.com/NinaComete/DOTG/master/20001-0.4-random/average.csv",
            "https://raw.githubusercontent.com/NinaComete/DOTG/master/20001-0.2-random/average.csv")
  
  # Initialisation des vecteurs
  taux_transmission <- c()
  max_avg_gen_accuracies <- c()
  max_avg_gen_accuracy_ranks <- c()
  max_avg_gen_srates <- c()
  max_avg_gen_srate_ranks <- c()
  last_ranks <- c()
  last_value_accuracies <- c()
  last_value_srates <- c()
  
  # Boucle sur chaque URL
  for (url in urls) {
    # Charger les donn?es
    data <- read.csv(url, header = TRUE, sep = " ")
    
    # Trouver l'indice o? avg.genAccuracy est maximale
    max_index_accuracy <- which.max(data$avg.genAccuracy)
    max_value_accuracy <- data$avg.genAccuracy[max_index_accuracy]
    max_rank_accuracy <- data$rank[max_index_accuracy]
    
    # Trouver l'indice o? avg.genSrate est maximale
    max_index_srate <- which.max(data$avg.genSrate)
    max_value_srate <- data$avg.genSrate[max_index_srate]
    max_rank_srate <- data$rank[max_index_srate]
    
    # Trouver l'indice de la derni?re it?ration
    last_index <- nrow(data)
    last_value_accuracy <- data$avg.genAccuracy[last_index]
    last_value_srate <- data$avg.genSrate[last_index]
    
    # Calcul du taux de transmission en fonction de l'URL
    if (grepl("-1-learn", url)) {
      taux_transmission_current <- "1"
    } else if (grepl("-0.8-learn", url)) {
      taux_transmission_current <- "0.8"
    } else if (grepl("-0.6-learn", url)) {
      taux_transmission_current <- "0.6"
    } else if (grepl("-0.4-learn", url)) {
      taux_transmission_current <- "0.4"
    } else if (grepl("-0.2-learn", url)) {
      taux_transmission_current <- "0.2"
    } else if (grepl("-random", url)) {
      taux_transmission_current <- "random"
    }  
    
    # Ajouter les informations aux vecteurs
    taux_transmission  <- c(taux_transmission , taux_transmission_current)
    max_avg_gen_accuracies <- c(max_avg_gen_accuracies, max_value_accuracy)
    max_avg_gen_accuracy_ranks <- c(max_avg_gen_accuracy_ranks, max_rank_accuracy)
    max_avg_gen_srates <- c(max_avg_gen_srates, max_value_srate)
    max_avg_gen_srate_ranks <- c(max_avg_gen_srate_ranks, max_rank_srate)
    last_ranks <- c(last_ranks, data$rank[last_index])
    last_value_accuracies <- c(last_value_accuracies, last_value_accuracy)
    last_value_srates <- c(last_value_srates, last_value_srate)
  }
  
  # Cr?ation du dataframe
  tableau_transmission_20001 <- data.frame(taux_transmission = taux_transmission,
                                           max_avg_gen_accuracy = max_avg_gen_accuracies,
                                           max_avg_gen_accuracy_rank = max_avg_gen_accuracy_ranks,
                                           max_avg_gen_srate = max_avg_gen_srates,
                                           max_avg_gen_srate_rank = max_avg_gen_srate_ranks,
                                           last_rank = last_ranks,
                                           last_value_accuracy = last_value_accuracies,
                                           last_value_srate = last_value_srates)
  
  return(tableau_transmission_20001)
}

# Creer le tableau recapitulatif
tableau_transmission_20001 <- create_summary_table()

library(dplyr)

# Cr?er un nouveau tableau pour les valeurs où "taux_transmission" n'est pas "random"
tableau_transmission_20001_effective_et_random <- tableau_transmission_20001 %>%
  filter(taux_transmission != "random")

# Calculer la moyenne des valeurs pour les lignes où "taux_transmission" est "random"
moyennes_random <- tableau_transmission_20001 %>%
  filter(taux_transmission == "random") %>%
  summarise_all(mean)

# Convertir la colonne "taux_transmission" en caractere dans moyennes_random
moyennes_random$taux_transmission <- as.character(moyennes_random$taux_transmission)

# Ajouter une nouvelle ligne au tableau avec les moyennes calculees pour "taux_transmission" = "random"
tableau_transmission_20001_effective_et_moy_random <- bind_rows(tableau_transmission_20001_effective_et_random, moyennes_random)

# Remplacer les valeurs <NA> par "random" dans la colonne "taux_transmission"
tableau_transmission_20001_effective_et_moy_random <- tableau_transmission_20001_effective_et_moy_random %>%
  mutate(taux_transmission = ifelse(is.na(taux_transmission), "moyenne_random", taux_transmission))


# Affichage du tableau recapitulatif avec une taille de police reduite
kable(tableau_transmission_20001_effective_et_moy_random, format = "html", align = "c", 
      col.names = c("Taux de transmission", 
                    "Max precision moyenne (avg.genAccuracy)", 
                    "Rang auquel la precision moyenne maximale est atteinte",
                    "Max succes moyen (avg.genSrate)", 
                    "Rang auquel le succes moyen maximal est atteint",
                    "Dernier rang", 
                    "Precision atteinte au dernier rang", 
                    "Succes atteint au dernier rang"),
      row.names = FALSE, 
      #caption = "Tableau recapitulatif des resultats",
      booktabs = TRUE) %>%
  kable_styling(full_width = FALSE, font_size = 10)  # R?duire la taille de police ? 12 points


```